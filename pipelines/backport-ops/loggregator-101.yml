# Remove resources unrelated to backport jobs
- type: remove
  path: /resources/name=loggregator-ci-docker-images
- type: remove
  path: /resources/name=agent-image
- type: remove
  path: /resources/name=router-image
- type: remove
  path: /resources/name=rlp-image
- type: remove
  path: /resources/name=bumper-tool

- type: remove
  path: /resources/name=loggregator-release-elect
- type: remove
  path: /resources/name=loggregator-release-master
- type: remove
  path: /resources/name=loggregator-agent-release-elect
- type: remove
  path: /resources/name=loggregator-agent
- type: remove
  path: /resources/name=loggregator-agent-release
- type: remove
  path: /resources/name=go-loggregator

# We don't need to regularly trigger backport pipelines
- type: remove
  path: /resources/name=10m
- type: remove
  path: /jobs/name=loggregator-tests/plan/0/aggregate/get=10m

# change resource branches
- type: replace
  path: /resources/name=loggregator-src/source/branch
  value: v101.x

- type: replace
  path: /resources/name=loggregator-release/source/branch
  value: v101.x

- type: replace
  path: /resources/name=cf-deployment/source/branch
  value: v1.16.0

- type: replace
  path: /resources/name=cf-acceptance-tests/source/branch
  value: cf1.16

- type: replace
  path: /resources/name=logging-acceptance-tests-release/source/branch
  value: v101.x

- type: replace
  path: /resources/name=cfar-logging-acceptance-tests/source/branch
  value: v101.x

# Remove jobs unrelated to backports
- type: remove
  path: /jobs/name=loggregator-docker-images
- type: remove
  path: /jobs/name=loggregator-promotion
- type: remove
  path: /jobs/name=loggregator-agent-promotion
- type: remove
  path: /jobs/name=loggregator-agent-tests
- type: remove
  path: /jobs/name=loggregator-agent-bump-submodule
- type: remove
  path: /jobs/name=loggregator-master-promotion

# Edit jobs

# Change bump submodule responsibilities
- type: remove
  path: /jobs/name=loggregator-bump-submodule/plan/0/aggregate/get=loggregator-agent
- type: remove
  path: /jobs/name=loggregator-bump-submodule/plan/0/aggregate/get=go-loggregator
- type: remove
  path: /jobs/name=loggregator-bump-submodule/plan/task=update-loggregator-agent
- type: remove
  path: /jobs/name=loggregator-bump-submodule/plan/task=update-go-loggregator
- type: replace
  path: /jobs/name=loggregator-bump-submodule/plan/task=update-loggregator/input_mapping/release-repo
  value: loggregator-release
- type: replace
  path: /jobs/name=loggregator-bump-submodule/plan/task=sync-package-specs/input_mapping/release-repo
  value: loggregator-release
- type: replace
  path: /jobs/name=loggregator-bump-submodule/plan/task=commit/params/PATHS
  value: |
    src/code.cloudfoundry.org/loggregator
    packages

- type: remove
  path: /jobs/name=loggregator-deploy/plan/0/aggregate/get=loggregator-agent-release

- type: remove
  path: /jobs/name=lats/plan/0/aggregate/get=loggregator-agent-release

- type: remove
  path: /jobs/name=cf-deploy/plan/1/aggregate/get=loggregator-agent-release
- type: remove
  path: /jobs/name=cf-deploy/plan/2/aggregate/task=upload-loggregator-agent-release
# copy ops files
- type: remove
  path: /jobs/name=cf-deploy/plan/3/do/task=copy-ops-files/config/inputs/name=loggregator-agent-release
- type: replace
  path: /jobs/name=cf-deploy/plan/3/do/task=copy-ops-files/config/run/args
  value:
  - "-c"
  - |
    set -e

    cp cf-deployment/operations/windows-cell.yml ops-files/
    cp cf-deployment/operations/scale-to-one-az.yml ops-files/
    cp cf-deployment/operations/experimental/use-bosh-dns.yml ops-files/
    cp cf-deployment/operations/experimental/use-bosh-dns-for-containers.yml ops-files/
    cp cf-deployment/operations/use-compiled-releases.yml ops-files/
    cp cf-deployment/operations/use-latest-windows-stemcell.yml ops-files/

    cat <<EOT >> ops-files/on-the-fly.yml
    - type: replace
      path: /releases/name=loggregator
      value:
        name: loggregator
        version: latest
    - type: replace
      path: /update/max_in_flight
      value: 5
    - type: replace
      path: /releases/name=diego
      value:
        name: diego
        version: $(bosh int cf-deployment/cf-deployment.yml --path=/releases/name=diego/version)
        url: $(bosh int cf-deployment/cf-deployment.yml --path=/releases/name=diego/url)
        sha1: $(bosh int cf-deployment/cf-deployment.yml --path=/releases/name=diego/sha1)
    - type: replace
      path: /instance_groups/name=doppler/instances
      value: 2
    - path: /releases/name=consul/url
      type: replace
      value: https://bosh.io/d/github.com/cloudfoundry-incubator/consul-release?v=192
    - path: /releases/name=consul/sha1
      type: replace
      value: 399894e3b4f5d4ba7ea5abe4ab89190ec2d4ad56
    EOT
- type: replace
  path: /jobs/name=cf-deploy/plan/3/do/task=cf-deploy/params/OPS_FILES
  value: |
    scale-to-one-az.yml
    use-compiled-releases.yml
    on-the-fly.yml
    windows-cell.yml
    use-latest-windows-stemcell.yml
    use-bosh-dns.yml
    use-bosh-dns-for-containers.yml

- type: remove
  path: /jobs/name=cats/plan/0/aggregate/get=loggregator-agent-release

- type: remove
  path: /jobs/name=cfar-lats/plan/0/aggregate/get=loggregator-agent-release
