resources:
- name: 15m
  type: time
  source: {interval: 15m}
- name: 1h
  type: time
  source: {interval: 1h}
- name: loggregator-ci
  type: git
  source:
    uri: https://github.com/cloudfoundry/loggregator-ci
- name: scalable-syslog-release
  type: git
  source:
    uri: https://github.com/cloudfoundry/scalable-syslog-release

jobs:
- name: floodspinner
  public: false
  serial: true
  plan:
  - get: loggregator-ci
  - get: 15m
    trigger: true
  - task: run-smoke-tests
    file: loggregator-ci/tasks/generic-smoke-test.yml
    params:
      CF_API: "api.run.pivotal.io"
      APP_DOMAIN: "floodspinner.cfapps.io"
      ORG: "cf-lamb"
      SPACE: "development"
      APP_NAME: "floodspinner"
      USERNAME: {{pws-username}}
      PASSWORD: {{pws-password}}
      WAIT: 60
      CYCLES: 10000
      DATADOG_API_KEY: {{datadog-loggregator-api-key}}
      DELAY: "2"
      DELAY_UNIT: "us"
      MESSAGE: "FIFTEEN-MINUTE"

- name: dripspinner
  public: false
  serial: true
  plan:
  - get: loggregator-ci
  - get: 1h
    trigger: true
  - task: run-smoke-tests
    file: loggregator-ci/tasks/generic-smoke-test.yml
    params:
      CF_API: "api.run.pivotal.io"
      APP_DOMAIN: "dripspinner.cfapps.io"
      ORG: "cf-lamb"
      SPACE: "development"
      APP_NAME: "dripspinner"
      USERNAME: {{pws-username}}
      PASSWORD: {{pws-password}}
      WAIT: 600
      CYCLES: 1000
      DATADOG_API_KEY: {{datadog-loggregator-api-key}}
      DELAY: "500"
      DELAY_UNIT: "ms"
      MESSAGE: "HOURLY"

- name: https-syslog-drain
  public: false
  serial: true
  plan:
  - get: loggregator-ci
  - get: scalable-syslog-release
  - get: 1h
    trigger: true
  - task: v1-drain
    file: loggregator-ci/tasks/scalable-syslog-smoke-test.yml
    params:
      CF_ORG: cf-lamb
      CF_PASSWORD: {{pws-password}}
      CF_SPACE: development
      CF_APP_DOMAIN: cfapps.io
      CF_SYSTEM_DOMAIN: run.pivotal.io
      CF_USERNAME: {{pws-username}}
      DATADOG_API_KEY: {{datadog-loggregator-api-key}}
      DRAIN_VERSION: "1.0"
      DRAIN_TYPE: "https"
      NUM_APPS: 50
  - task: v2-drain
    file: loggregator-ci/tasks/scalable-syslog-smoke-test.yml
    params:
      CF_ORG: cf-lamb
      CF_PASSWORD: {{pws-password}}
      CF_SPACE: development
      CF_APP_DOMAIN: cfapps.io
      CF_SYSTEM_DOMAIN: run.pivotal.io
      CF_USERNAME: {{pws-username}}
      DATADOG_API_KEY: {{datadog-loggregator-api-key}}
      DRAIN_VERSION: "2.0"
      DRAIN_TYPE: "https"
      NUM_APPS: 50

- name: tcp-syslog-drain
  public: false
  serial: true
  plan:
  - get: loggregator-ci
  - get: scalable-syslog-release
  - get: 1h
    trigger: true
  - task: v1-drain
    file: loggregator-ci/tasks/scalable-syslog-smoke-test.yml
    params:
      CF_ORG: cf-lamb
      CF_PASSWORD: {{pws-password}}
      CF_SPACE: development
      CF_APP_DOMAIN: cf-tcpapps.io
      CF_SYSTEM_DOMAIN: run.pivotal.io
      CF_USERNAME: {{pws-username}}
      DATADOG_API_KEY: {{datadog-loggregator-api-key}}
      DRAIN_VERSION: "1.0"
      DRAIN_TYPE: "syslog"
      NUM_APPS: 50
  - task: v2-drain
    file: loggregator-ci/tasks/scalable-syslog-smoke-test.yml
    params:
      CF_ORG: cf-lamb
      CF_PASSWORD: {{pws-password}}
      CF_SPACE: development
      CF_APP_DOMAIN: cf-tcpapps.io
      CF_SYSTEM_DOMAIN: run.pivotal.io
      CF_USERNAME: {{pws-username}}
      DATADOG_API_KEY: {{datadog-loggregator-api-key}}
      DRAIN_VERSION: "2.0"
      DRAIN_TYPE: "syslog"
      NUM_APPS: 50

- name: https-syslog-drain-no-teardown
  public: false
  serial: true
  plan:
  - get: loggregator-ci
  - get: scalable-syslog-release
  - get: 1h
    trigger: true
  - task: v2-drain
    file: loggregator-ci/tasks/scalable-syslog-smoke-test.yml
    params:
      TEARDOWN: false
      CF_ORG: cf-lamb
      CF_PASSWORD: {{pws-password}}
      CF_SPACE: development
      CF_APP_DOMAIN: cfapps.io
      CF_SYSTEM_DOMAIN: run.pivotal.io
      CF_USERNAME: {{pws-username}}
      DATADOG_API_KEY: {{datadog-loggregator-api-key}}
      DRAIN_VERSION: "2.0"
      DRAIN_TYPE: "https"
      JOB_NAME: "https-no-teardown"

- name: tcp-syslog-drain-no-teardown
  public: false
  serial: true
  plan:
  - get: loggregator-ci
  - get: scalable-syslog-release
  - get: 1h
    trigger: true
  - task: v2-drain
    file: loggregator-ci/tasks/scalable-syslog-smoke-test.yml
    params:
      TEARDOWN: false
      CF_ORG: cf-lamb
      CF_PASSWORD: {{pws-password}}
      CF_SPACE: development
      CF_APP_DOMAIN: cf-tcpapps.io
      CF_SYSTEM_DOMAIN: run.pivotal.io
      CF_USERNAME: {{pws-username}}
      DATADOG_API_KEY: {{datadog-loggregator-api-key}}
      DRAIN_VERSION: "2.0"
      DRAIN_TYPE: "syslog"
      JOB_NAME: "syslog-no-teardown"
